generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String       @id @default(uuid())
  
  name          String
  firstName     String
  lastName      String
  image         String?
  
  email         String
  emailVerified Boolean
  
  createdAt     DateTime
  updatedAt     DateTime
  
  role          String?
  
  banned        Boolean?
  banReason     String?
  banExpires    DateTime?
  
  sessions      Session[]
  accounts      Account[]
  
  members       Member[]
  invitations   Invitation[]
  
  settings      Settings?

  createdProjects Project[] @relation("CreatedProjects")
  updatedProjects Project[] @relation("UpdatedProjects")

  @@unique([email])
  @@map("user")
}

model Settings {
  id String @id @default(uuid())

  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  // AI settings
  aiEnabled  Boolean? @default(false)
  aiProvider String? // e.g. 'openai', 'anthropic'
  aiModel    String? // e.g. 'gpt-4o', 'claude-3'
  aiApiKey   String?

  // Appearance settings
  accentColor String? // 'blue', 'green', etc.
  homepageHints Boolean? @default(true)
  editorFont  String? // 'inter', 'roboto', 'mono', etc.

  // General settings
  language        String?  @default("en")
  showRawMarkdown Boolean? @default(false)
  showToc         Boolean? @default(true)
  developerMode   Boolean? @default(false)
  showStats       Boolean? @default(false)
}

model Session {
  id                   String   @id @default(uuid())
  token                String
  
  createdAt            DateTime
  updatedAt            DateTime
  expiresAt            DateTime
  
  ipAddress            String?
  userAgent            String?
  
  userId               String
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  activeOrganizationId String?
  impersonatedBy       String?

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id @default(uuid())

  accountId             String
  providerId            String
  
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  accessToken           String?
  refreshToken          String?
  idToken               String?
  
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  
  scope                 String?
  password              String?
  
  createdAt             DateTime
  updatedAt             DateTime

  @@map("account")
}

model Verification {
  id         String    @id @default(uuid())
  identifier String
  
  value      String
  
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

model Organization {
  id          String       @id @default(uuid())
  name        String
  slug        String?
  logo        String?
  createdAt   DateTime    @default(now())
  metadata    String?
  members     Member[]
  invitations Invitation[]
  projects    Project[]

  @@unique([slug])
  @@map("organization")
}

model Project {
  id          String    @id @default(uuid())

  name        String
  description String?
  icon        String?

  content Bytes?

  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  createdById String
  createdBy   User   @relation("CreatedProjects", fields: [createdById], references: [id])
  
  updatedById String?
  updatedBy   User?   @relation("UpdatedProjects", fields: [updatedById], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?

  @@index([createdById])
  @@index([updatedById])
}

model Member {
  id             String       @id @default(uuid())
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  userId         String
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  role           String
  createdAt      DateTime     @default(now())

  @@map("member")
}

model Invitation {
  id             String       @id @default(uuid())
  
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  
  email          String
  role           String?
  
  status         String
  expiresAt      DateTime
  
  inviterId      String
  user           User         @relation(fields: [inviterId], references: [id], onDelete: Cascade)

  @@map("invitation")
}
