
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String  @id @default(cuid())
  email         String  @unique
  name          String
  firstName     String?
  lastName      String?
  emailVerified Boolean @default(false)
  image         String?

  // Relations pour Auth.js
  accounts Account[]
  sessions Session[]

  // Vos autres relations
  settings Settings?
  teams    Team[]     @relation("TeamUser")
  TeamUser TeamUser[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user")
}

model Account {
  id                   String    @id @default(cuid())
  userId               String
  type                 String    @default("oauth")
  providerId           String // Better Auth expects 'providerId'
  accountId            String // Better Auth expects 'accountId'
  refreshToken         String?
  accessToken          String?
  accessTokenExpiresAt DateTime?
  scope                String?
  idToken              String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  refreshTokenExpiresAt DateTime?
  password              String?

  @@unique([providerId, accountId])
  @@map("account")
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  ipAddress String? // Pour le tracking de sécurité
  userAgent String? // Pour le tracking de sécurité
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("session")
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String   @unique
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([identifier, value])
  @@map("verification")
}

// Vos autres modèles existants

model Team {
  id   Int    @id @default(autoincrement())
  name String

  members  User[]    @relation("TeamUser")
  projects Project[]

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  TeamUser  TeamUser[]
}

enum Role {
  member
  admin
  owner
}

model TeamUser {
  id Int @id @default(autoincrement())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  teamId          Int
  team            Team      @relation(fields: [teamId], references: [id])
  role            Role      @default(member)
  ProjectsCreated Project[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, teamId])
}

model Settings {
  id Int @id @default(autoincrement())

  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  theme      String  @default("light")
  language   String  @default("fr")
  aiProvider String  @default("Groq")
  aiModel    String  @default("llama")
  aiApiKey   String?
}

model Project {
  id          Int     @id @default(autoincrement())
  name        String
  description String?
  icon        String?

  teamId Int
  team   Team @relation(fields: [teamId], references: [id])

  creatorId Int
  creator   TeamUser @relation(fields: [creatorId], references: [id])

  content Bytes?

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}
